

<!DOCTYPE html>
<html lang="en">

<head>
  
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ODU ALMP Docs components/users/Login.js</title>

  <script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="./build/entry.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,400,700|Inconsolata,700" rel="stylesheet">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
  <link type="text/css" rel="stylesheet" href="https://jmblog.github.io/color-themes-for-google-code-prettify/themes/tomorrow-night.min.css">
  <link type="text/css" rel="stylesheet" href="styles/app.min.css">
  <link type="text/css" rel="stylesheet" href="styles/iframe.css">
  <link type="text/css" rel="stylesheet" href="">
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  
</head>



<body class="layout small-header">
    <div id="stickyNavbarOverlay"></div>
    

<div class="top-nav">
    <div class="inner">
        <a id="hamburger" role="button" class="navbar-burger" aria-label="menu" aria-expanded="false">
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
            <span aria-hidden="true"></span>
        </a>
        <div class="logo">
            
             
                <a href="index.html">
                    <h1 class="navbar-item">Asynchronous Learning Management System @ ODU-EMSE</h1>
                </a>
            
        </div>
        <div class="menu">
            
            <div class="navigation">
                <a
                    href="index.html"
                    class="link"
                >
                    Documentation
                </a>
                
                 
                    
                        <a
                            class="link user-link "
                            href="https://github.com/odu-emse/emsePortal"
                        >
                            Github - UI
                        </a>
                    
                        <a
                            class="link user-link "
                            href="https://github.com/odu-emse/emseAPI"
                        >
                            Github - API
                        </a>
                    
                
                
            </div>
        </div>
    </div>
</div>
    <div id="main">
        <div
            class="sidebar "
            id="sidebarNav"
        >
            
                <div class="search-wrapper">
                    <input id="search" type="text" placeholder="Search docs..." class="input">
                </div>
            
            <nav>
                
                    <h2><a href="index.html">Documentation</a></h2><div class="category"><h3>Classes</h3><ul><li><a href="App.html">App</a></li></ul></div><div class="category"><h2>Authentication</h2><h3>Classes</h3><ul><li><a href="Register.html">Register</a></li></ul><h3>Components</h3><ul><li><a href="Login.html">Login</a></li><li><a href="Protector.html">Protector</a></li><li><a href="UserVerify.html">UserVerify</a></li></ul></div><div class="category"><h2>Context</h2><h3>Modules</h3><ul><li><a href="module-InstructorProfileContext.html">InstructorProfileContext</a></li></ul></div><div class="category"><h2>Hooks</h2><h3>Modules</h3><ul><li><a href="module-GetPlanByStudentID.html">GetPlanByStudentID</a></li></ul></div><div class="category"><h2>Plan Of Study</h2><h3>Components</h3><ul><li><a href="PlanOfStudy.html">PlanOfStudy</a></li><li><a href="Profile.html">Profile</a></li></ul></div><div class="category"><h2>Program</h2><h3>Components</h3><ul><li><a href="Course.html">Course</a></li><li><a href="Dashboard.html">Dashboard</a></li><li><a href="ModuleHousing.html">ModuleHousing</a></li></ul></div><div class="category"><h2>User</h2><h3>Components</h3><ul><li><a href="UserInfo.html">UserInfo</a></li></ul></div><div class="category"><h2>helper</h2><h3>Global</h3><ul><li><a href="global.html#abandonModule">abandonModule</a></li><li><a href="global.html#calculateRating">calculateRating</a></li><li><a href="global.html#checkTaken">checkTaken</a></li><li><a href="global.html#convert">convert</a></li><li><a href="global.html#decoder">decoder</a></li><li><a href="global.html#getModule">getModule</a></li><li><a href="global.html#getRandomNum">getRandomNum</a></li><li><a href="global.html#getToken">getToken</a></li><li><a href="global.html#isAuthenticated">isAuthenticated</a></li><li><a href="global.html#loader">loader</a></li><li><a href="global.html#profileCheck">profileCheck</a></li><li><a href="global.html#progress">progress</a></li><li><a href="global.html#rating">rating</a></li><li><a href="global.html#refreshPage">refreshPage</a></li><li><a href="global.html#removeToken">removeToken</a></li><li><a href="global.html#round_to_precision">round_to_precision</a></li></ul></div>
                
            </nav>
        </div>
        <div class="core" id="main-content-wrapper">
            <div class="content">
                <header class="page-title">
                    <p>Source</p>
                    <h1>components/users/Login.js</h1>
                </header>
                



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useState } from 'react'
import axios from 'axios'
import { ToastContainer, toast } from 'react-toastify'
import { getToken, refreshPage, loader } from '../helpers'
import { Link } from 'react-router-dom'

/**
 * @component
 * @name Login
 * @category Authentication
 * @description This component is used to render the login page.
 * @param {React.FC&lt;Props>} props - Simple props object that we use to redirect the user after they are successfully authenticated. The members of this object come from `react-router-dom`'s `&lt;Route>` component.
 * @returns {React.ReactHTMLElement} The rendered HTML element that wraps this component within the page.
 */
const Login = (props) => {
	/**
	 * @member
	 * @name LoginComponentState
	 * @memberof Login
	 * @type {React.ComponentState}
	 * @property {String | null} [email=null] The current state of the email form field.
	 * @property {String | null} [password=null] The current state of the password form field.
	 * @property {Boolean} [loading=false] The current state of the loading indicator based on fetching and requests being sent.
	 * @description This is the states of the component. These properties come from the return of the initialization of the specific `useState`, which returns a tuple of the current state and a function that allows us to update the state. Initial values are set on load.
	 */
	const [email, setEmail] = useState(null)
	const [password, setPassword] = useState(null)
	const [loading, setLoading] = useState(false)

	/**
	 *
	 * @param {React.FormEvent} e - The event that is triggered when the user changes the form data.
	 * @function
	 * @memberof Login
	 * @description This function is used to handle all the changes that are done to either the email or password fields in the form.
	 * @todo Simplify this function by switch the state of the email and password fields to a single user state with email and password as a key.
	 */
	const change = (e) => {
		if (e.target.name === 'email') {
			setEmail(e.target.value)
		}
		if (e.target.name === 'password') {
			setPassword(e.target.value)
		}
	}

	/**
	 * @name onLogin
	 * @description This function takes in an html event element to prevent the default browser behavior. It then creates the GraphQL query to login the user, and asks for the token back as a response. If no errors are present in the returned data, the token is saved in local storage and the user is redirected to the home page after a success message. If errors are present, an error message is displayed in a small notification toast.
	 * @function
	 * @memberof Login
	 * @param {React.FormEvent} e - The event that is triggered when the user submits the form.
	 */
	const onLogin = (e) => {
		e.preventDefault()

		setLoading(true)

		let data = {
			query: `query{
				login (input: {email: "${email}", password: "${password}"}){
                    token
				}
			}`,
		}

		if (email.length > 0 &amp;&amp; password.length > 0) {
			axios
				.post(`${process.env.REACT_APP_API}/graphql`, data)
				.then((res) => {
					if (res.data.errors) {
						setLoading(false)
						return toast.error(res.data.errors[0].message, {
							position: toast.POSITION.TOP_RIGHT,
						})
					} else {
						const { token } = res.data.data.login
						setLoading(false)
						localStorage.setItem('JWT', token)
						// refreshPage()
						return props.history.push('/dashboard')
					}
				})
				.catch((err) => {
					console.error('onLogin() error: ', err)
					setLoading(false)
				})
		} else {
			setLoading(false)
			return toast.error('Please fill out all fields.', {
				position: toast.POSITION.TOP_RIGHT,
			})
		}
	}

	if (loading) {
		return loader()
	} else {
		if (getToken() !== `Bearer ${null}`) {
			props.history.push('/portal')
			return null
		} else {
			return (
				&lt;div className="lg:w-1/2 md:w-2/3 sm:mx-4 md:mx-auto mt-4 bg-gray-100 py-5 px-3 rounded shadow border border-gray">
					&lt;h1 className="text-3xl">Login&lt;/h1>
					&lt;ToastContainer />
					&lt;form className="w-full my-1">
						&lt;div className="my-3 w-full">
							&lt;label
								htmlFor="email"
								className="text-gray-400 font-xs"
							>
								ODU affiliated email
							&lt;/label>
							&lt;input
								type="email"
								className="py-2 px-3 w-full border border-gray rounded "
								placeholder="example@odu.edu"
								name="email"
								value={email}
								onChange={(e) => change(e)}
								required
							/>
						&lt;/div>
						&lt;div className="my-3 w-full">
							&lt;label
								htmlFor="password"
								className="text-gray-400 font-xs"
							>
								Password
							&lt;/label>
							&lt;input
								type="password"
								className="py-2 px-3 w-full border border-gray rounded"
								placeholder="Password"
								name="password"
								onChange={(e) => change(e)}
								required
							/>
						&lt;/div>
						&lt;button
							className="text-gray-100 rounded border-2 border-blue-400 py-2 px-4 bg-blue-400 w-1/2 mx-auto block transition-all hover:bg-transparent hover:text-gray-800"
							type="submit"
							onClick={(e) => onLogin(e)}
						>
							Log in
						&lt;/button>
						&lt;div className="w-full text-center">
							&lt;div className="mt-4 block font-sm text-gray-800 font-weight-light">
								or{' '}
								&lt;Link to="/users/forgot" className="">
									&lt;span className="hover:underline hover:text-gray-800 text-blue-800">
										Reset your password
									&lt;/span>
								&lt;/Link>
							&lt;/div>
							&lt;div className="mt-4 block font-sm text-gray-800 font-weight-light">
								Don't have an account?{' '}
								&lt;Link to="/users/register">
									&lt;span className="hover:underline hover:text-gray-800 text-blue-800 font-bold">
										Sign up
									&lt;/span>
								&lt;/Link>
							&lt;/div>
						&lt;/div>
					&lt;/form>
				&lt;/div>
			)
		}
	}
}

export default Login
</code></pre>
        </article>
    </section>




            </div>
            
        </div>
        <div id="side-nav" class="side-nav">
        </div>
    </div>
<script src="scripts/app.min.js"></script>
<script>PR.prettyPrint();</script>
<script src="scripts/linenumber.js"> </script>

<script src="scripts/search.js"> </script>


</body>
</html>
